

# 1 `Ezvcard` class #

For most writing operations, the [Ezvcard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/Ezvcard.html) class can be used.  This class contains static methods that make use of method chaining, providing an elegant and user-friendly way to write a vCard.

For example, the code below writes a version 4.0 vCard to a file.

```
VCard vcard = ...
File file = new File("vcard.vcf");
Ezvcard.write(vcard).version(VCardVersion.V4_0).go(file);
```

## 1.1 Entry methods ##

Different write methods can be called, depending on the format of the vCard.  Each method accepts one or more [VCard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/VCard.html) objects as parameters.

| `Ezvcard.write(...)` | Writes vCards in the traditional, plain text format. |
|:---------------------|:-----------------------------------------------------|
| `Ezvcard.writeXml(...)` | Writes vCards to an XML document (xCard).            |
| `Ezvcard.writeHtml(...)` | Writes vCards to an HTML page (hCard).               |
| `Ezvcard.writeJson(...)` | Writes vCards to a JSON stream (jCard).              |

## 1.2 Chaining methods ##

The following chaining methods can be called to customize the write operation.  The methods which are available depend on the type of vCard being written.

| **Method**                        | **Text** | **XML** | **HTML** | **JSON** | **Description** |
|:----------------------------------|:---------|:--------|:---------|:---------|:----------------|
| `caretEncoding(boolean)`          | x        |         |          |          | Sets whether parameter values should be encoded using circumflex accent encoding (disabled by default).  See the [javadocs](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/text/VCardWriter.html#setCaretEncodingEnabled(boolean)) for a description of this encoding mechanism. |
| `indent(int)`                     |          | x       |          |          | Pretty-prints the XML and specifies the number of spaces to use as the indent string.  By default, the XML string will not be pretty-printed. |
| `indent(boolean)`                 |          |         |          | x        | Pretty-prints the JSON stream.  By default, the JSON stream will not be pretty-printed. |
| `prodId(boolean)`                 | x        | x       |          | x        | Sets whether or not to add a PRODID property to each vCard, which says that the vCard was generated by this library (enabled by default). For 2.1 vCards, the extended type X-PRODID is used, since PRODID is not supported by that version. |
| `register(VCardPropertyScribe)`   | x        | x       |          | x        | Registers a property scribe.  See [ExtendedProperties](ExtendedProperties.md) for more information on scribes. |
| `version(VCardVersion)`           | x        |         |          |          | Sets the version that the vCard will be written as.  Defaults to the version that's attached to the [VCard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/VCard.html) objects or to 3.0 if the [VCard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/VCard.html) object does not have a version.  XML- and JSON-encoded vCards are always marshalled to version 4.0. HTML-encoded vCards are not marshalled in any version-specific way. |
| `versionStrict(boolean)`          | x        | x       |          | x        | If enabled, properties that do not support the target vCard version will be excluded from the written vCard (enabled by default). |

## 1.3 Termination method ##

The chaining operation terminates when one of the following methods is called.  The methods which are available depend on the type of vCard being written.

| **Method**  | **Text** | **XML** | **HTML** | **JSON** | **Description** |
|:------------|:---------|:--------|:---------|:---------|:----------------|
| `go(...)`   | x        | x       | x        | x        | Writes the vCard(s) to an output stream, such as a `String`, `File`, `OutputStream`, or `Writer`. |
| `dom()`     |          | x       |          |          | Returns the raw DOM of the generated XML document (a "`org.w3c.dom.Document`" object). |

# 2 `VCard.write()` methods #

A vCard can also be written by calling one of the `VCard.write(...)` methods.  This method is overloaded to support a variety outputs, including `String`, `File`, `OutputStream`, and `Writer`.  There are `write(...)` methods for every format (text, XML, HTML, and JSON).  Under the hood, these methods call [Ezvcard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/Ezvcard.html).

When writing a plain-text vCard, the vCard will be marshalled to the version attached to the [VCard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/VCard.html) object (see: `VCard.get/setVersion()`).  If the object does not have a version attached to it, it will be marshalled to version 3.0.

Also note that if the [VCard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/VCard.html) object contains any user-defined property classes, the vCard cannot be written using this method.  This is because the custom scribe classes must be registered with the writer before writing the vCard.

# 3 Writer classes #

For additional control over the write operation, the following classes can be used.  These are what [Ezvcard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/Ezvcard.html) calls under the hood.

| **Class** | **Description** | **Streaming?** |
|:----------|:----------------|:---------------|
| [VCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/text/VCardWriter.html)    | Writes vCards in the traditional, plain text format. | yes            |
| [XCardDocument](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/xml/XCardDocument.html) | Writes vCards to an XML document (xCard). | no             |
| [XCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/xml/XCardDocument.html)   | Writes vCards to an XML document (xCard). | yes            |
| [HCardPage](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/html/HCardPage.html)        | Writes vCards to an HTML page (hCard). | no             |
| [JCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/json/JCardWriter.html)    | Writes vCards to a JSON stream (jCard). | yes            |

## 3.1 `VCardWriter` ##

[VCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/text/VCardWriter.html) is used to write vCards in the traditional, plain text format.  Use the `write(VCard)` method to write a vCard to the output stream.

The example below writes a list of version 3.0 vCards to a file.

```
List<VCard> vcards = ...
VCardVersion version = VCardVersion.V3_0;
File file = new File("vcards.vcf");
VCardWriter writer = new VCardWriter(file, version);
for (VCard vcard : vcards){
  writer.write(vcard);
}
writer.close();
```

## 3.2 `XCardDocument` ##

[XCardDocument](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/xml/XCardDocument.html) is used to write vCards to an XML document (xCard standard).  Use the `add(VCard)` method to add a vCard to the XML document.  This adds it to an in-memory, XML DOM.  Once all vCards have been added, use one of the `write()` methods to marshal the XML document.  You can also call the `getDocument()` method at any time to gain access to the raw DOM.

The example below writes a list of vCards to an XML file.

```
List<VCard> vcards = ...
XCardDocument xcardDocument = new XCardDocument();

//add vCards
for (VCard vcard : vcards){
  xcardDocument.add(vcard);
}

//access raw DOM
Document document = xcardDocument.getDocument();

//write XML
File file = new File("vcards.xml")
xcardDocument.write(file, 2);
```

## 3.3 `XCardWriter` ##

[XCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/xml/XCardWriter.html) is used to write vCards to an XML document (xCard standard) in a streaming fashion.  Use the `write(VCard)` method to write a vCard to the output stream.

The example below writes a list of vCards to a file.

```
List<VCard> vcards = ...
File file = new File("vcards.xml");
XCardWriter writer = new XCardWriter(file, version);
for (VCard vcard : vcards){
  writer.write(vcard);
}
writer.close();
```

It's important to remember to **close the [XCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/xml/XCardWriter.html)** when the write operation is complete.  This is required in order for the XML stream to be properly terminated.

## 3.4 `HCardPage` ##

[HCardPage](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/html/HCardPage.html) is used to generate a basic webpage that contains HTML-encoded vCards (hCard standard).  Use the `add(VCard)` method to add a vCard to the HTML document.  Once all vCards have been added, use one of the `write()` methods to generate the HTML document.

The example below writes a list of vCards to an HTML file.

```
List<VCard> vcards = ...
HCardPage page = new HCardPage();

//add vCards
for (VCard vcard : vcards){
  page.add(vcard);
}

//write HTML
File file = new File("vcards.html")
page.write(file);
```

If your application does not require hCard writing functionality, you can exclude the "freemarker" dependency from your build.

```
<dependency>
  <groupId>com.googlecode.ez-vcard</groupId>
  <artifactId>ez-vcard</artifactId>
  <version>...</version>
  <exclusions>
    <!-- hCard writing not needed -->
    <exclusion>
      <groupId>org.freemarker</groupId>
      <artifactId>freemarker</artifactId>
    </exclusion>
  </exclusions>
</dependency>
```

## 3.5 `JCardWriter` ##

[JCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/json/JCardWriter.html) is used to write vCards in JSON format (jCard standard).  Use the `write(VCard)` method to write a vCard to the output stream.

The example below writes a list of vCards to a file.

```
List<VCard> vcards = ...
File file = new File("vcards.json");
JCardWriter jcw = new JCardWriter(file, true); //"true" wraps the jCards in a JSON array
for (VCard vcard : vcards){
  jcw.write(vcard);
}
jcw.close();
```

It's important to remember to **close the [JCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/json/JCardWriter.html)** when the write operation is complete.  This is required in order for the JSON stream to be properly terminated.  There are two ways to close it.

  1. [JCardWriter.close()](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/json/JCardWriter.html#close()) - Terminates the JSON stream **and** the output stream.
  1. [JCardWriter.closeJsonStream()](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/json/JCardWriter.html#closeJsonStream()) - Terminates the JSON stream, but keeps the output stream open.

If your application does not require jCard writing functionality, you can exclude the "jackson-core" dependency from your build.

```
<dependency>
  <groupId>com.googlecode.ez-vcard</groupId>
  <artifactId>ez-vcard</artifactId>
  <version>...</version>
  <exclusions>
    <!-- jCard writing not needed -->
    <exclusion>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-core</artifactId>
    </exclusion>
  </exclusions>
</dependency>
```

# 4 Differences between `Ezvcard` and writer classes #

Most of the functionality in the writer classes can be accessed from [Ezvcard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/Ezvcard.html).  However, there is one exception.

## 4.1 Streaming ##

[VCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/text/VCardWriter.html), [XCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/xml/XCardWriter.html), and [JCardWriter](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/json/JCardWriter.html) are streaming--they write each vCard to the output stream one at a time.  This is useful if many [VCard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/VCard.html) objects need to be written and they cannot all be stored in memory at once.  [Ezvcard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/Ezvcard.html), by contrast, requires that all [VCard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/VCard.html) objects be stored in memory at the same time in order to write them.

The code sample below shows how the streaming API works.  Each [VCard](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/VCard.html) object is created, then written one at a time, allowing them to be garbage collected once they have been written.

```
Writer writer = ...
VCardWriter vcardWriter = new VCardWriter(writer);
while (...) {
  VCard vcard = //generate a vCard
  vcardWriter.write(vcard);
}
vcardWriter.close();
```

[XCardDocument](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/xml/XCardDocument.html) and [HCardPage](https://ez-vcard.googlecode.com/svn/javadocs/latest/ezvcard/io/html/HCardPage.html) are **not** streaming.  These classes must create the entire XML/HTML document in memory before it can be written out.